<!DOCTYPE html>
<html lang="en"><head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-html/tabby.min.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-48ffa3e5b9d089919c6712c39e5b00f2.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.41">

  <meta name="author" content="Nathaniel Forde">
  <meta name="dcterms.date" content="2025-05-13">
  <title>Examined Algorithms – Structural Causal Models in PyMC</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/theme/quarto-6bc9fff661875e715c2c8f03ff78ee7e.css">
  <link href="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
  
  <script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Structural Causal Models in PyMC</h1>
  <p class="subtitle">Conditionalisation Strategies and Valid Causal Inference</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Nathaniel Forde 
</div>
        <p class="quarto-title-affiliation">
            Data Science @ Personio
          </p>
        <p class="quarto-title-affiliation">
            and Open Source Contributor @ PyMC
          </p>
    </div>
</div>

  <p class="date">2025-05-13</p>
</section>
<section>
<section id="the-pitch" class="title-slide slide level1 center">
<h1>The Pitch</h1>
<p>Structural causal models impose extra-statistical constraints on the derivation of <span class="blue"><strong>valid causal claims</strong></span> from data.</p>
<p>These constraints can be understood concretely with reference to the SEM literature. We outline the development of structural causal models in the Bayesian setting highlighting the use of the do-operator on generative model graph structures.</p>
</section>
<section id="preliminaries" class="slide level2 smaller">
<h2>Preliminaries</h2>
<div class="callout callout-warning callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Who am I?</strong></p>
</div>
<div class="callout-content">
<ul>
<li>I’m a <strong>data scientist</strong> at <strong><span class="blue">Personio</span></strong>
<ul>
<li>Bayesian statistician,</li>
<li>Reformed philosopher and logician.</li>
</ul></li>
<li>Website: <a href="https://nathanielf.github.io/">https://nathanielf.github.io/</a></li>
</ul>
</div>
</div>
</div>
<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Code or it didn’t Happen</strong></p>
</div>
<div class="callout-content">
<ul>
<li>The worked examples used here can be found <a href="https://www.pymc.io/projects/examples/en/latest/case_studies/CFA_SEM.html">here</a></li>
<li><a href="../../talks/ukraine_sem/notebook/bayesian_sem.html" download="">Download SEM Notebook</a></li>
<li><a href="notebook/sem_data.csv" download="">SEM Data</a></li>
</ul>
</div>
</div>
</div>

<img data-src="images/QR_CODE.png" class="r-stretch quarto-figure-center"><p class="caption">My Website</p></section>
<section id="agenda" class="slide level2 smaller">
<h2>Agenda</h2>
<h3 id="abstract---concrete---code">Abstract -&gt; Concrete -&gt; Code</h3>
<div class="columns">
<div class="column">
<ul>
<li><span class="blue"><strong>Valid Causal Structure</strong></span>
<ul>
<li>Form and Content of Causal Inference</li>
<li>Abstract Conception</li>
<li>Concrete Conception</li>
<li>The Bayesian Phrasing</li>
<li>Implementation in Code</li>
</ul></li>
<li><span class="blue"><strong>Factor Structures</strong></span>
<ul>
<li>Measurement Models: Abstract Conception</li>
<li>Bayesian Phrasing: Concrete Example</li>
<li>Bayesian Phrasing: Code in PyMC</li>
<li>Model Fit and Diagnostics</li>
</ul></li>
</ul>
</div><div class="column">
<ul>
<li><span class="blue"><strong>Structural Equation Models</strong></span>
<ul>
<li>Adding Structural Components</li>
<li>The SEM Model in PyMC</li>
<li>Model Comparison: CFA and SEM</li>
</ul></li>
<li><span class="blue"><strong>Causal Estimands and the Do-Operator</strong></span>
<ul>
<li>The Do-Calculus and Minimum Valid Structure</li>
<li>What-if Structures and the Do-Operator</li>
<li>The Do-Operator in PyMC</li>
<li>Causal Estimands under Intervention</li>
</ul></li>
</ul>
</div></div>
</section></section>
<section>
<section id="valid-causal-structure" class="title-slide slide level1 center">
<h1>Valid Causal Structure</h1>

</section>
<section id="form-and-content-of-causal-inference" class="slide level2 smller">
<h2>Form and Content of Causal Inference</h2>
<h3 id="directed-acyclic-graphs-and-their-meaning">Directed Acyclic Graphs and their Meaning</h3>
<div class="columns">
<div class="column r-fit-text">
<blockquote>
<p>“Every proposition has a content and a form. We get the picture of the pure form if we abstract from the meaning of the single words, or symbols (so far as they have independent meanings)… <strong>By syntax in this general sense of the word I mean the rules which tell us in which connections only a word [makes] sense, thus excluding nonsensical structures.</strong>” - Wittgenstein <em>Some Remarks on Logical Form</em></p>
</blockquote>
</div><div class="column">
<p><img data-src="images/probable_graphs.png" alt="Sets of Admissable Graphs"> <span class="math display">\[ \psi | \neg \psi | \psi \rightarrow \phi \]</span></p>
</div><p>Sets of Admissable Graphs and Well formed valid Fomulae</p>
</div>
</section>
<section id="abstract-conception" class="slide level2">
<h2>Abstract Conception</h2>
<h3 id="non-parametric-structural-diagrams">Non-Parametric Structural Diagrams</h3>
<div class="columns">
<div class="column">
<p><img data-src="images/rct_dag.webp"></p>
</div><div class="column">
<p><img data-src="images/iv_dag.webp"></p>
</div><div class="column r-fit-text">
<p>Non-parametric Structural Causal Models highlight the aspects of the Data Generating processes that threaten the <span class="blue"><strong>valid</strong></span> construction of a causal claim.</p>
</div><div class="column r-fit-text">
<p><span class="math display">\[ Y \sim f_{Y}(Z, X, U_{Y})  \]</span> <span class="math display">\[ Z \sim f_{Z}(X, IV, U_{Z})\]</span> <span class="math display">\[ X \sim f_{X}(U_{X})\]</span> <span class="math display">\[ IV \sim f_{IV}(U_{IV})\]</span></p>
</div></div>
</section>
<section id="concrete-conception" class="slide level2">
<h2>Concrete Conception</h2>
<h3 id="parametric-approximation-via-regression">Parametric Approximation via Regression</h3>
<div class="columns">
<div class="column">
<p><img data-src="images/rct_dag.webp"></p>
</div><div class="column">
<p><img data-src="images/iv_dag.webp"></p>
</div><div class="column r-fit-text">
<p><span class="math display">\[ y \sim 1 + Z + u \]</span> Regression Approximation to estimating <span class="blue"><strong>valid</strong></span> coefficients in systems of simultaneous equation via 2SLS.</p>
</div><div class="column r-fit-text">
<p><span class="math display">\[ y \sim 1 + \widehat{Z} + u \]</span> <span class="math display">\[ \widehat{Z} \sim 1 + IV + u \]</span></p>
</div></div>
</section>
<section id="the-bayesian-phrasing" class="slide level2">
<h2>The Bayesian Phrasing</h2>
<div class="columns">
<div class="column r-fit-text">
<p><span class="math display">\[\begin{align*}
\left(
\begin{array}{cc}
Y \\
Z
\end{array}
\right)
&amp; \sim
\text{MultiNormal}(\color{green} \mu, \color{purple} \Sigma) \\
\color{green} \mu &amp; = \left(
\begin{array}{cc}
\mu_{y} \\
\mu_{z}
\end{array}
\right)
=
\left(
\begin{array}{cc}
\beta_{00} + \color{blue} \beta_{01}Z ... \\
\beta_{10} + \beta_{11}IV ...
\end{array}
\right)
\end{align*}
\]</span></p>
<p>The treatment effect <span class="math inline">\(\color{blue}\beta_{01}\)</span> of is the primary quantity of interest</p>
<div class="fragment fade-in">
<p><span class="math display">\[ \color{purple} \Sigma  = \begin{bmatrix}
1 &amp; \color{purple} \sigma \\
\color{purple} \sigma &amp; 1
\end{bmatrix}
\]</span> But the estimation depends on the multivariate realisation of the data</p>
</div>
</div><div class="column r-fit-text">
<div class="fragment fade-in">
<ul>
<li>Even the “simple” IV design is a structural causal model.</li>
</ul>
</div>
<div class="fragment fade-in">
<ul>
<li>The crucial component is the covariance structure of the joint-distribution and the instrument’s theoretical <strong>validity</strong></li>
</ul>
</div>
<div class="fragment fade-in">
<ul>
<li>The Bayesian Estimation strategy estimates the IV model by seeking a parameterisation where the potential outcomes are conditionally exchangeable.</li>
</ul>
<p><span class="math display">\[ p((y_{1}, z_{1})^{T} ....(y_{q}, z_{q})^{T}) = \dfrac{p(YZ | \theta)p(\theta)}{\sum p_{i}(YZ)}  \]</span></p>
<p><span class="math display">\[ = \dfrac{p( (y_{1}, z_{1})^{T} ....(y_{q}, z_{q})^{T}) | \Sigma , \beta)p(\Sigma , \beta) }{\sum p_{i}(YZ)} \]</span></p>
</div>
</div></div>
</section>
<section id="implementation-in-code" class="slide level2">
<h2>Implementation in Code</h2>
<h3 id="pymc-model-context">PyMC model context</h3>
<div class="sourceCode" id="cb1" data-code-line-numbers="|4-15|18-23|30-34|42-47"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a></a><span class="co">## PyMC model context</span></span>
<span id="cb1-2"><a></a><span class="cf">with</span> pm.Model() <span class="im">as</span> iv_model:</span>
<span id="cb1-3"><a></a>    <span class="co"># Initialising Regression Priors</span></span>
<span id="cb1-4"><a></a>    beta_t <span class="op">=</span> pm.Normal(</span>
<span id="cb1-5"><a></a>        name<span class="op">=</span><span class="st">"beta_t"</span>,</span>
<span id="cb1-6"><a></a>        mu<span class="op">=</span>priors[<span class="st">"mus_t"</span>],</span>
<span id="cb1-7"><a></a>        sigma<span class="op">=</span>priors[<span class="st">"sigma_t"</span>],</span>
<span id="cb1-8"><a></a>        dims<span class="op">=</span><span class="st">"instruments"</span>)</span>
<span id="cb1-9"><a></a></span>
<span id="cb1-10"><a></a>    beta_z <span class="op">=</span> pm.Normal(</span>
<span id="cb1-11"><a></a>        name<span class="op">=</span><span class="st">"beta_z"</span>,</span>
<span id="cb1-12"><a></a>        mu<span class="op">=</span>priors[<span class="st">"mus_z"</span>],</span>
<span id="cb1-13"><a></a>        sigma<span class="op">=</span>priors[<span class="st">"sigma_z"</span>],</span>
<span id="cb1-14"><a></a>        dims<span class="op">=</span><span class="st">"covariates"</span>)</span>
<span id="cb1-15"><a></a>    </span>
<span id="cb1-16"><a></a>    <span class="co"># Covariance Prior Parameters</span></span>
<span id="cb1-17"><a></a>    sd_dist <span class="op">=</span> pm.Exponential.dist(priors[<span class="st">"lkj_sd"</span>], shape<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb1-18"><a></a>    chol, corr, sigmas <span class="op">=</span> pm.LKJCholeskyCov(</span>
<span id="cb1-19"><a></a>        name<span class="op">=</span><span class="st">"chol_cov"</span>,</span>
<span id="cb1-20"><a></a>        eta<span class="op">=</span>priors[<span class="st">"eta"</span>],</span>
<span id="cb1-21"><a></a>        n<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb1-22"><a></a>        sd_dist<span class="op">=</span>sd_dist,</span>
<span id="cb1-23"><a></a>    )</span>
<span id="cb1-24"><a></a>    <span class="co"># compute and store the covariance matrix</span></span>
<span id="cb1-25"><a></a>    pm.Deterministic(name<span class="op">=</span><span class="st">"cov"</span>, </span>
<span id="cb1-26"><a></a>    var<span class="op">=</span>pt.dot(l<span class="op">=</span>chol, r<span class="op">=</span>chol.T))</span>
<span id="cb1-27"><a></a></span>
<span id="cb1-28"><a></a>    <span class="co"># --- Parameterization ---</span></span>
<span id="cb1-29"><a></a>    <span class="co"># focal regression</span></span>
<span id="cb1-30"><a></a>    mu_y <span class="op">=</span> pm.Deterministic(name<span class="op">=</span><span class="st">"mu_y"</span>, </span>
<span id="cb1-31"><a></a>    var<span class="op">=</span>pm.math.dot(X, beta_z))</span>
<span id="cb1-32"><a></a>    <span class="co"># instrumental regression</span></span>
<span id="cb1-33"><a></a>    mu_t <span class="op">=</span> pm.Deterministic(name<span class="op">=</span><span class="st">"mu_t"</span>, </span>
<span id="cb1-34"><a></a>    var<span class="op">=</span>pm.math.dot(Z, beta_t))</span>
<span id="cb1-35"><a></a>    </span>
<span id="cb1-36"><a></a>    <span class="co"># Stack regressions for MvNormal</span></span>
<span id="cb1-37"><a></a>    mu <span class="op">=</span> pm.Deterministic(name<span class="op">=</span><span class="st">"mu"</span>, </span>
<span id="cb1-38"><a></a>    var<span class="op">=</span>pt.stack(tensors<span class="op">=</span>(mu_y, mu_t), </span>
<span id="cb1-39"><a></a>    axis<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb1-40"><a></a></span>
<span id="cb1-41"><a></a>    <span class="co"># --- Likelihood ---</span></span>
<span id="cb1-42"><a></a>    pm.MvNormal(</span>
<span id="cb1-43"><a></a>        name<span class="op">=</span><span class="st">"likelihood"</span>,</span>
<span id="cb1-44"><a></a>        mu<span class="op">=</span>mu,</span>
<span id="cb1-45"><a></a>        chol<span class="op">=</span>chol,</span>
<span id="cb1-46"><a></a>        observed<span class="op">=</span>np.stack(arrays<span class="op">=</span>(y, t), axis<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb1-47"><a></a>        shape<span class="op">=</span>(X.shape[<span class="dv">0</span>], <span class="dv">2</span>),</span>
<span id="cb1-48"><a></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="functional-form-and-the-state-of-the-world" class="slide level2">
<h2>Functional Form and the State of the World</h2>
<h3 id="credible-maps">Credible Maps</h3>
<div class="columns">
<div class="column r-fit-text">
<p>Causal Structural Models generate valid causal claims just when:</p>
<ul>
<li>the mathematical model is apt to account for risks of confounding in the assumed data generating process</li>
<li>the model parameters or theoretical estimands can be properly identified and estimated with the data available.</li>
<li>the assumed data generating process is a close enough approximation of the actual process</li>
<li>The set of admissable causal claims is constrained by the <strong><span class="blue">substantive extra-statistical requirement</span></strong> to credibly map model to the world</li>
</ul>
</div><div class="column r-fit-text">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/framework.png"></p>
<figcaption>Theory and Credibility by Ashworth et al</figcaption>
</figure>
</div>
<div class="fragment fade-in">
<p><span class="math display">\[ \Bigg( \begin{array}{cc}
Y \sim f_{Y}(Z, X, U_{Y}) \\
Z \sim f_{Z}(X, IV, U_{Z})
\end{array} \Bigg) \approxeq \Bigg[ \begin{array}{cc}
Y \sim 1 + \widehat{Z} + u \\
\widehat{Z} \sim 1 + IV + u
\end{array} \Bigg] \\
\approxeq \dfrac{p( (y_{1}, z_{1})^{T} ....(y_{q}, z_{q})^{T}) | \color{purple}\Sigma ,\color{blue}\beta \color{black} )p(\color{purple}\Sigma ,\color{blue}\beta \color{black}) }{\sum p_{i}(YZ)}
\]</span></p>
</div>
</div></div>
</section></section>
<section>
<section id="factor-structures" class="title-slide slide level1 center">
<h1>Factor Structures</h1>

</section>
<section id="confirmatory-factor-structures" class="slide level2 smaller">
<h2>Confirmatory Factor Structures</h2>
<h3 id="and-conditional-exchangeability">and Conditional Exchangeability</h3>
<p>Assumptions of exchangeability in survey measurement and De-Finetti’s theorem <span class="math display">\[p(Y​,T, X_{1}…,X_n​)  =  \int p(Y, T, X_{1} ... X_n ​∣\theta)p(\theta)d(\theta)\]</span></p>
<p>ensures the observed data can be represented as conditionally independent mixture distribution where in general:</p>
<p><span class="math display">\[X_{i} \perp\!\!\!\!\perp X_{j} | \theta \text {        } \forall i \neq j\]</span></p>
<p>and in paticular latent factors <span class="math inline">\(\Lambda\)</span> are hypothetical <strong><span class="blue">common causes</span></strong> argued to induce conditional exchangeability among the observed data.</p>
<p><span class="math display">\[ Y(0), Y(1) \perp\!\!\!\!\perp T | \Lambda\]</span></p>
</section>
<section id="factor-structures-as-measurement-models" class="slide level2">
<h2>Factor Structures as Measurement Models</h2>
<div class="columns">
<div class="column r-fit-text">
<p><span class="math display">\[ ADJUST \sim f_{ADJUST}(motiv, harm, stabi, U)  \]</span> <span class="math display">\[ RISK \sim f_{RISK}(ppsych, ses, verbal, U)\]</span> <span class="math display">\[ ACHIEVE \sim f_{ACHIEVE}(read, arith, spell, U)\]</span></p>
<p>Non-parametric phrasing of SCMs under-specifies the relations of interest.</p>
<p>CFA models estimates the multivariate correlation structure while imposing the <span class="blue"><strong>focal causal structure</strong></span> and dependencies to “hide” detail in measurement error.</p>
</div><div class="column r-fit-text">
<p><img data-src="images/factor_structure.png"></p>
</div></div>
</section>
<section id="measurement-models" class="slide level2 smaller">
<h2>Measurement Models</h2>
<h3 id="and-structured-priors">and Structured Priors</h3>
<p>The Confirmatory Factor Model can also be phrased in the Bayesian way.</p>
<p><span class="math display">\[p(\mathbf{x_{i}}^{T}.....\mathbf{x_{q}}^{T} | \text{Ksi}, \Psi, \tau, \Lambda) \sim Normal(\tau + \Lambda\cdot \text{Ksi}, \Psi)\]</span></p>
<p><span class="math display">\[ \lambda_{11} ..... \lambda_{21} ..... \lambda_{31} \in \Lambda \]</span></p>
<div id="9d030ca4" class="cell" data-execution_count="1">
<div class="cell-output cell-output-display" data-execution_count="1">
<style type="text/css">
#T_2e17e_row0_col0, #T_2e17e_row0_col1, #T_2e17e_row0_col2, #T_2e17e_row1_col0, #T_2e17e_row1_col1, #T_2e17e_row1_col2, #T_2e17e_row2_col0, #T_2e17e_row2_col1, #T_2e17e_row2_col2, #T_2e17e_row3_col0, #T_2e17e_row3_col1, #T_2e17e_row3_col2, #T_2e17e_row4_col0, #T_2e17e_row4_col1, #T_2e17e_row4_col2 {
  background-color: lightcoral;
}
#T_2e17e_row0_col3, #T_2e17e_row0_col4, #T_2e17e_row0_col5, #T_2e17e_row1_col3, #T_2e17e_row1_col4, #T_2e17e_row1_col5, #T_2e17e_row2_col3, #T_2e17e_row2_col4, #T_2e17e_row2_col5, #T_2e17e_row3_col3, #T_2e17e_row3_col4, #T_2e17e_row3_col5, #T_2e17e_row4_col3, #T_2e17e_row4_col4, #T_2e17e_row4_col5 {
  background-color: moccasin;
}
</style>

<table id="T_2e17e" class="caption-top" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="blank level0" data-quarto-table-cell-role="th">&nbsp;</th>
<th id="T_2e17e_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">motiv</th>
<th id="T_2e17e_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">harm</th>
<th id="T_2e17e_level0_col2" class="col_heading level0 col2" data-quarto-table-cell-role="th">stabi</th>
<th id="T_2e17e_level0_col3" class="col_heading level0 col3" data-quarto-table-cell-role="th">ppsych</th>
<th id="T_2e17e_level0_col4" class="col_heading level0 col4" data-quarto-table-cell-role="th">ses</th>
<th id="T_2e17e_level0_col5" class="col_heading level0 col5" data-quarto-table-cell-role="th">verbal</th>
<th id="T_2e17e_level0_col6" class="col_heading level0 col6" data-quarto-table-cell-role="th">read</th>
<th id="T_2e17e_level0_col7" class="col_heading level0 col7" data-quarto-table-cell-role="th">arith</th>
<th id="T_2e17e_level0_col8" class="col_heading level0 col8" data-quarto-table-cell-role="th">spell</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_2e17e_level0_row0" class="row_heading level0 row0" data-quarto-table-cell-role="th">0</td>
<td id="T_2e17e_row0_col0" class="data row0 col0">-7.907122</td>
<td id="T_2e17e_row0_col1" class="data row0 col1">-5.075312</td>
<td id="T_2e17e_row0_col2" class="data row0 col2">-3.138836</td>
<td id="T_2e17e_row0_col3" class="data row0 col3">-17.800210</td>
<td id="T_2e17e_row0_col4" class="data row0 col4">4.766450</td>
<td id="T_2e17e_row0_col5" class="data row0 col5">-3.633360</td>
<td id="T_2e17e_row0_col6" class="data row0 col6">-3.488981</td>
<td id="T_2e17e_row0_col7" class="data row0 col7">-9.989121</td>
<td id="T_2e17e_row0_col8" class="data row0 col8">-6.567873</td>
</tr>
<tr class="even">
<td id="T_2e17e_level0_row1" class="row_heading level0 row1" data-quarto-table-cell-role="th">1</td>
<td id="T_2e17e_row1_col0" class="data row1 col0">1.751478</td>
<td id="T_2e17e_row1_col1" class="data row1 col1">-4.155847</td>
<td id="T_2e17e_row1_col2" class="data row1 col2">3.520752</td>
<td id="T_2e17e_row1_col3" class="data row1 col3">7.009367</td>
<td id="T_2e17e_row1_col4" class="data row1 col4">-6.048681</td>
<td id="T_2e17e_row1_col5" class="data row1 col5">-7.693461</td>
<td id="T_2e17e_row1_col6" class="data row1 col6">-4.520552</td>
<td id="T_2e17e_row1_col7" class="data row1 col7">8.196238</td>
<td id="T_2e17e_row1_col8" class="data row1 col8">8.778973</td>
</tr>
<tr class="odd">
<td id="T_2e17e_level0_row2" class="row_heading level0 row2" data-quarto-table-cell-role="th">2</td>
<td id="T_2e17e_row2_col0" class="data row2 col0">14.472570</td>
<td id="T_2e17e_row2_col1" class="data row2 col1">-4.540677</td>
<td id="T_2e17e_row2_col2" class="data row2 col2">4.070600</td>
<td id="T_2e17e_row2_col3" class="data row2 col3">23.734260</td>
<td id="T_2e17e_row2_col4" class="data row2 col4">-16.970670</td>
<td id="T_2e17e_row2_col5" class="data row2 col5">-3.909941</td>
<td id="T_2e17e_row2_col6" class="data row2 col6">-4.818170</td>
<td id="T_2e17e_row2_col7" class="data row2 col7">7.529984</td>
<td id="T_2e17e_row2_col8" class="data row2 col8">-5.688716</td>
</tr>
<tr class="even">
<td id="T_2e17e_level0_row3" class="row_heading level0 row3" data-quarto-table-cell-role="th">3</td>
<td id="T_2e17e_row3_col0" class="data row3 col0">-1.165421</td>
<td id="T_2e17e_row3_col1" class="data row3 col1">-5.668406</td>
<td id="T_2e17e_row3_col2" class="data row3 col2">2.600437</td>
<td id="T_2e17e_row3_col3" class="data row3 col3">1.493158</td>
<td id="T_2e17e_row3_col4" class="data row3 col4">1.396363</td>
<td id="T_2e17e_row3_col5" class="data row3 col5">21.409450</td>
<td id="T_2e17e_row3_col6" class="data row3 col6">-3.138441</td>
<td id="T_2e17e_row3_col7" class="data row3 col7">5.730547</td>
<td id="T_2e17e_row3_col8" class="data row3 col8">-2.915676</td>
</tr>
<tr class="odd">
<td id="T_2e17e_level0_row4" class="row_heading level0 row4" data-quarto-table-cell-role="th">4</td>
<td id="T_2e17e_row4_col0" class="data row4 col0">-4.222899</td>
<td id="T_2e17e_row4_col1" class="data row4 col1">-10.072150</td>
<td id="T_2e17e_row4_col2" class="data row4 col2">-6.030737</td>
<td id="T_2e17e_row4_col3" class="data row4 col3">-5.985864</td>
<td id="T_2e17e_row4_col4" class="data row4 col4">-18.376400</td>
<td id="T_2e17e_row4_col5" class="data row4 col5">-1.438816</td>
<td id="T_2e17e_row4_col6" class="data row4 col6">-2.009742</td>
<td id="T_2e17e_row4_col7" class="data row4 col7">-0.623953</td>
<td id="T_2e17e_row4_col8" class="data row4 col8">-1.024624</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="measurement-model-graph" class="slide level2">
<h2>Measurement Model Graph</h2>

<img data-src="images/mm.png" class="r-stretch"></section>
<section id="measurement-models-in-pymc" class="slide level2">
<h2>Measurement Models in PyMC</h2>
<div class="sourceCode" id="cb2" data-code-line-numbers="|2-9|11-19|24-27|29-33|35-46|49-57"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a></a></span>
<span id="cb2-2"><a></a>coords <span class="op">=</span> {</span>
<span id="cb2-3"><a></a>    <span class="st">"obs"</span>: <span class="bu">list</span>(<span class="bu">range</span>(<span class="bu">len</span>(df))),</span>
<span id="cb2-4"><a></a>    <span class="st">"indicators"</span>: [<span class="st">"motiv"</span>, <span class="st">"harm"</span>, <span class="st">"stabi"</span>, <span class="st">"verbal"</span>, <span class="st">"ses"</span>, <span class="st">"ppsych"</span>, <span class="st">"read"</span>, <span class="st">"arith"</span>, <span class="st">"spell"</span>],</span>
<span id="cb2-5"><a></a>    <span class="st">"indicators_1"</span>: [<span class="st">"motiv"</span>, <span class="st">"harm"</span>, <span class="st">"stabi"</span>],</span>
<span id="cb2-6"><a></a>    <span class="st">"indicators_2"</span>: [<span class="st">"verbal"</span>, <span class="st">"ses"</span>, <span class="st">"ppsych"</span>],</span>
<span id="cb2-7"><a></a>    <span class="st">"indicators_3"</span>: [<span class="st">"read"</span>, <span class="st">"arith"</span>, <span class="st">"spell"</span>],</span>
<span id="cb2-8"><a></a>    <span class="st">"latent"</span>: [<span class="st">"adjust"</span>, <span class="st">"risk"</span>, <span class="st">"achieve"</span>],</span>
<span id="cb2-9"><a></a>}</span>
<span id="cb2-10"><a></a></span>
<span id="cb2-11"><a></a><span class="kw">def</span> make_lambda(indicators, name<span class="op">=</span><span class="st">'lambdas1'</span>, priors<span class="op">=</span>[<span class="dv">1</span>, <span class="dv">10</span>]):</span>
<span id="cb2-12"><a></a>    <span class="co">""" Takes an argument indicators which is a string in the coords dict"""</span></span>
<span id="cb2-13"><a></a>    temp_name <span class="op">=</span> name <span class="op">+</span> <span class="st">'_'</span></span>
<span id="cb2-14"><a></a>    lambdas_ <span class="op">=</span> pm.Normal(temp_name, priors[<span class="dv">0</span>], priors[<span class="dv">1</span>], dims<span class="op">=</span>(indicators))</span>
<span id="cb2-15"><a></a>    <span class="co"># Force a fixed scale on the factor loadings for factor 1</span></span>
<span id="cb2-16"><a></a>    lambdas_1 <span class="op">=</span> pm.Deterministic(</span>
<span id="cb2-17"><a></a>        name, pt.set_subtensor(lambdas_[<span class="dv">0</span>], <span class="dv">1</span>), dims<span class="op">=</span>(indicators)</span>
<span id="cb2-18"><a></a>    )</span>
<span id="cb2-19"><a></a>    <span class="cf">return</span> lambdas_1</span>
<span id="cb2-20"><a></a></span>
<span id="cb2-21"><a></a>obs_idx <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="bu">len</span>(df)))</span>
<span id="cb2-22"><a></a><span class="cf">with</span> pm.Model(coords<span class="op">=</span>coords) <span class="im">as</span> model:</span>
<span id="cb2-23"><a></a></span>
<span id="cb2-24"><a></a>    <span class="co"># Set up Factor Loadings</span></span>
<span id="cb2-25"><a></a>    lambdas_1 <span class="op">=</span> make_lambda(<span class="st">'indicators_1'</span>, <span class="st">'lambdas1'</span>)</span>
<span id="cb2-26"><a></a>    lambdas_2 <span class="op">=</span> make_lambda(<span class="st">'indicators_2'</span>, <span class="st">'lambdas2'</span>, priors<span class="op">=</span>[<span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb2-27"><a></a>    lambdas_3 <span class="op">=</span> make_lambda(<span class="st">'indicators_3'</span>, <span class="st">'lambdas3'</span>)</span>
<span id="cb2-28"><a></a>    </span>
<span id="cb2-29"><a></a>    <span class="co"># Specify covariance structure between latent factors</span></span>
<span id="cb2-30"><a></a>    sd_dist <span class="op">=</span> pm.Exponential.dist(<span class="fl">1.0</span>, shape<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb2-31"><a></a>    chol, _, _ <span class="op">=</span> pm.LKJCholeskyCov(<span class="st">"chol_cov"</span>, n<span class="op">=</span><span class="dv">3</span>, eta<span class="op">=</span><span class="dv">2</span>, sd_dist<span class="op">=</span>sd_dist, compute_corr<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb2-32"><a></a>    ksi <span class="op">=</span> pm.MvNormal(<span class="st">"ksi"</span>, <span class="dv">0</span>, chol<span class="op">=</span>chol, dims<span class="op">=</span>(<span class="st">"obs"</span>, <span class="st">"latent"</span>))</span>
<span id="cb2-33"><a></a></span>
<span id="cb2-34"><a></a>    <span class="co"># Construct Pseudo Observation matrix based on Factor Loadings</span></span>
<span id="cb2-35"><a></a>    m1 <span class="op">=</span> ksi[obs_idx, <span class="dv">0</span>] <span class="op">*</span> lambdas_1[<span class="dv">0</span>]</span>
<span id="cb2-36"><a></a>    m2 <span class="op">=</span> ksi[obs_idx, <span class="dv">0</span>] <span class="op">*</span> lambdas_1[<span class="dv">1</span>]</span>
<span id="cb2-37"><a></a>    m3 <span class="op">=</span> ksi[obs_idx, <span class="dv">0</span>] <span class="op">*</span> lambdas_1[<span class="dv">2</span>]</span>
<span id="cb2-38"><a></a>    m4 <span class="op">=</span> ksi[obs_idx, <span class="dv">1</span>] <span class="op">*</span> lambdas_2[<span class="dv">0</span>]</span>
<span id="cb2-39"><a></a>    m5 <span class="op">=</span> ksi[obs_idx, <span class="dv">1</span>] <span class="op">*</span> lambdas_2[<span class="dv">1</span>]</span>
<span id="cb2-40"><a></a>    m6 <span class="op">=</span> ksi[obs_idx, <span class="dv">1</span>] <span class="op">*</span> lambdas_2[<span class="dv">2</span>]</span>
<span id="cb2-41"><a></a>    m7 <span class="op">=</span> ksi[obs_idx, <span class="dv">2</span>] <span class="op">*</span> lambdas_3[<span class="dv">0</span>]</span>
<span id="cb2-42"><a></a>    m8 <span class="op">=</span> ksi[obs_idx, <span class="dv">2</span>] <span class="op">*</span> lambdas_3[<span class="dv">1</span>]</span>
<span id="cb2-43"><a></a>    m9 <span class="op">=</span> ksi[obs_idx, <span class="dv">2</span>] <span class="op">*</span> lambdas_3[<span class="dv">2</span>]</span>
<span id="cb2-44"><a></a></span>
<span id="cb2-45"><a></a>    mu <span class="op">=</span> pm.Deterministic(<span class="st">"mu"</span>, pm.math.stack([m1, m2, m3, m4, m5, m6, m7, m8, m9]).T)</span>
<span id="cb2-46"><a></a></span>
<span id="cb2-47"><a></a>    <span class="co">## Error Terms</span></span>
<span id="cb2-48"><a></a>    Psi <span class="op">=</span> pm.InverseGamma(<span class="st">"Psi"</span>, <span class="dv">2</span>, <span class="dv">13</span>, dims<span class="op">=</span><span class="st">"indicators"</span>)</span>
<span id="cb2-49"><a></a></span>
<span id="cb2-50"><a></a>    <span class="co"># Likelihood</span></span>
<span id="cb2-51"><a></a>    _ <span class="op">=</span> pm.Normal(</span>
<span id="cb2-52"><a></a>        <span class="st">"likelihood"</span>,</span>
<span id="cb2-53"><a></a>        mu,</span>
<span id="cb2-54"><a></a>        Psi,</span>
<span id="cb2-55"><a></a>        observed<span class="op">=</span>df[coords[<span class="st">'indicators'</span>]].values,</span>
<span id="cb2-56"><a></a>    )</span>
<span id="cb2-57"><a></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="model-estimates-factor-loadings" class="slide level2 smaller">
<h2>Model Estimates: Factor Loadings</h2>
<div class="columns">
<div class="column">
<p><img data-src="images/factorweights.png"> <img data-src="images/mm_traceplot.png"></p>
</div><div class="column">
<div class="fragment fade-in">
<ul>
<li>The weights accorded to each of the indicator metrics on each of the specified factors are scaled.</li>
</ul>
</div>
<div class="fragment fade-in">
<ul>
<li>Consistency in the factor loadings is a gauge of factor coherence.</li>
</ul>
</div>
<div class="fragment fade-in">
<ul>
<li>Invariance of the loading scale across groups supports the argument to robust constructs.</li>
</ul>
</div>
</div></div>
</section>
<section id="model-fit-covariance-structures" class="slide level2">
<h2>Model Fit: Covariance Structures</h2>
<p><img data-src="images/measuremodel_resids.png"> The differences between the sample covariance and model predicted covariances are small.</p>
</section>
<section id="model-fit-posterior-predictive-checks" class="slide level2">
<h2>Model Fit: Posterior Predictive Checks</h2>
<p><img data-src="images/measuremodel_ppc.png"> The model can successfully retrodict the observed data, indicating good model fit.</p>
</section>
<section id="model-implications-latent-scores" class="slide level2 smaller">
<h2>Model Implications: Latent Scores</h2>
<div class="columns">
<div class="column" style="width:70%;">
<p><img data-src="images/latent_measures.png"></p>
</div><div class="column" style="width:30%;">
<ul>
<li>Bayesian Models <strong>sample</strong> the Latent constructs</li>
<li>Assess the measurement profile of individual outliers under intervention.</li>
<li>Allows us to interrogate what are the relations between these Latent components?</li>
<li>How do thet vary under pressure?</li>
</ul>
</div></div>
</section></section>
<section>
<section id="structural-equation-models" class="title-slide slide level1 center">
<h1>Structural Equation Models</h1>

</section>
<section id="adding-structural-components" class="slide level2">
<h2>Adding Structural Components</h2>
<h3 id="regression-structures-are-overlaid">Regression Structures are Overlaid</h3>
<div class="columns">
<div class="column r-fit-text">
<p><code>adjust =~ motiv + harm + stabi</code></p>
<p><code>risk =~ verbal + ses + ppsych</code></p>
<p><code>achieve =~ read + arith + spell</code></p>
<div class="fragment fade-in">
<p><code>adjust ~ risk</code></p>
<p><code>achieve ~ adjust + risk</code></p>
</div>
</div><div class="column r-fit-text">
<p><span class="math display">\[SEM : \underbrace{\text{Ksi}^{*}}_{latent} = \underbrace{\mathbf{B}\text{Ksi}}_{structural \\ component} + \underbrace{\Lambda\cdot \text{Ksi}}_{measurement \\ component}\]</span></p>
<p><span class="math display">\[CFA : \underbrace{\text{Ksi}^{*}}_{latent} = \underbrace{\mathbf{0}\text{Ksi}}_{structural \\ component} + \underbrace{\Lambda\cdot \text{Ksi}}_{measurement \\ component}\]</span></p>
</div></div>
</section>
<section id="the-structural-matrix" class="slide level2 smaller">
<h2>The Structural Matrix</h2>
<p><span class="math display">\[ \overbrace{\text{Ksi}}^{latent} = \begin{bmatrix} \overbrace{2.5}^{adjust} &amp; \overbrace{3.2}^{risk} &amp; \overbrace{7.3}^{achieve} \\ ... &amp; ... &amp; ...
\\ ... &amp; ... &amp; ...  \\ ... &amp; ... \\ 3.9 &amp; ...\end{bmatrix} \begin{bmatrix} 0 &amp; \beta_{12} &amp; \beta_{13}
\\ \beta_{21} &amp; 0 &amp; \beta_{23}
\\ \beta_{31} &amp; \beta_{32} &amp; 0 \end{bmatrix} = \underbrace{\mathbf{B}}_{Regression \\ Coefficients} \]</span></p>
<div class="r-stack">
<div class="fragment fade-in">
<p><img data-src="images/B_matrix_target.png"></p>
</div>
</div>
</section>
<section id="the-structural-matrix-1" class="slide level2 smaller">
<h2>The Structural Matrix</h2>
<p>The specification of the structural matrix encodes the candidate regression relations which are to be evaluated in the SEM fit.</p>
<p><span class="math display">\[ \overbrace{\text{Ksi}}^{latent} = \begin{bmatrix} \overbrace{2.5}^{adjust} &amp; \overbrace{3.2}^{risk} &amp; \overbrace{7.3}^{achieve} \\ ... &amp; ... &amp; ...
\\ ... &amp; ... &amp; ...  \\ ... &amp; ... \\ 3.9 &amp; ...\end{bmatrix} \begin{bmatrix} 0 &amp; 0 &amp; \color{blue}{\beta_{13}}
\\ \color{blue}{\beta_{21}} &amp; 0 &amp; \color{blue}{\beta_{23}}
\\ 0 &amp; 0 &amp; 0 \end{bmatrix} = \underbrace{\mathbf{B}}_{Regression \\ Coefficients} \]</span></p>
<div class="r-stack">
<p><code>adjust ~ risk</code></p>
</div>
<div class="r-stack">
<p><code>achieve ~ adjust + risk</code></p>
</div>
</section>
<section id="the-sem-model-in-pymc" class="slide level2 smaller">
<h2>The SEM Model in PyMC</h2>
<h3 id="defining-the-dag">Defining the DAG</h3>
<div class="sourceCode" id="cb3" data-code-line-numbers="|25-35|36-47"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a></a></span>
<span id="cb3-2"><a></a>coords <span class="op">=</span> {</span>
<span id="cb3-3"><a></a>    <span class="st">"obs"</span>: <span class="bu">list</span>(<span class="bu">range</span>(<span class="bu">len</span>(df))),</span>
<span id="cb3-4"><a></a>    <span class="st">"indicators"</span>: [<span class="st">"motiv"</span>, <span class="st">"harm"</span>, <span class="st">"stabi"</span>, <span class="st">"verbal"</span>, <span class="st">"ses"</span>, <span class="st">"ppsych"</span>, <span class="st">"read"</span>, <span class="st">"arith"</span>, <span class="st">"spell"</span>],</span>
<span id="cb3-5"><a></a>    <span class="st">"indicators_1"</span>: [<span class="st">"motiv"</span>, <span class="st">"harm"</span>, <span class="st">"stabi"</span>],</span>
<span id="cb3-6"><a></a>    <span class="st">"indicators_2"</span>: [<span class="st">"verbal"</span>, <span class="st">"ses"</span>, <span class="st">"ppsych"</span>],</span>
<span id="cb3-7"><a></a>    <span class="st">"indicators_3"</span>: [<span class="st">"read"</span>, <span class="st">"arith"</span>, <span class="st">"spell"</span>],</span>
<span id="cb3-8"><a></a>    <span class="st">"latent"</span>: [<span class="st">"adjust"</span>, <span class="st">"risk"</span>, <span class="st">"achieve"</span>],</span>
<span id="cb3-9"><a></a>    <span class="st">"paths"</span>: [<span class="st">"risk-&gt;adjust"</span>, <span class="st">"risk--&gt;achieve"</span>, <span class="st">"adjust--&gt;achieve"</span>]</span>
<span id="cb3-10"><a></a>    }</span>
<span id="cb3-11"><a></a></span>
<span id="cb3-12"><a></a>    obs_idx <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="bu">len</span>(df)))</span>
<span id="cb3-13"><a></a>    <span class="cf">with</span> pm.Model(coords<span class="op">=</span>coords) <span class="im">as</span> model:</span>
<span id="cb3-14"><a></a></span>
<span id="cb3-15"><a></a>        <span class="co"># Set up Factor Loadings</span></span>
<span id="cb3-16"><a></a>        lambdas_1 <span class="op">=</span> make_lambda(<span class="st">'indicators_1'</span>, <span class="st">'lambdas1'</span>, priors<span class="op">=</span>[<span class="dv">1</span>, <span class="fl">.5</span>]) <span class="co">#adjust</span></span>
<span id="cb3-17"><a></a>        lambdas_2 <span class="op">=</span> make_lambda(<span class="st">'indicators_2'</span>, <span class="st">'lambdas2'</span>, priors<span class="op">=</span>[<span class="dv">1</span>, <span class="fl">.5</span>]) <span class="co"># risk</span></span>
<span id="cb3-18"><a></a>        lambdas_3 <span class="op">=</span> make_lambda(<span class="st">'indicators_3'</span>, <span class="st">'lambdas3'</span>, priors<span class="op">=</span>[<span class="dv">1</span>, <span class="fl">.5</span>]) <span class="co"># achieve</span></span>
<span id="cb3-19"><a></a>        </span>
<span id="cb3-20"><a></a>        <span class="co"># Specify covariance structure between latent factors</span></span>
<span id="cb3-21"><a></a>        sd_dist <span class="op">=</span> pm.Exponential.dist(<span class="fl">1.0</span>, shape<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb3-22"><a></a>        chol, _, _ <span class="op">=</span> pm.LKJCholeskyCov(<span class="st">"chol_cov"</span>, n<span class="op">=</span><span class="dv">3</span>, eta<span class="op">=</span><span class="dv">2</span>, sd_dist<span class="op">=</span>sd_dist, compute_corr<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-23"><a></a>        ksi <span class="op">=</span> pm.MvNormal(<span class="st">"ksi"</span>, <span class="dv">0</span>, chol<span class="op">=</span>chol, dims<span class="op">=</span>(<span class="st">"obs"</span>, <span class="st">"latent"</span>))</span>
<span id="cb3-24"><a></a></span>
<span id="cb3-25"><a></a>        <span class="co">## Build Regression Components</span></span>
<span id="cb3-26"><a></a>        coefs <span class="op">=</span> pm.Normal(<span class="st">'betas'</span>, <span class="dv">0</span>, <span class="fl">.5</span>, dims<span class="op">=</span><span class="st">'paths'</span>)</span>
<span id="cb3-27"><a></a>        zeros <span class="op">=</span> pt.zeros((<span class="dv">3</span>, <span class="dv">3</span>))</span>
<span id="cb3-28"><a></a>        <span class="co">## adjust ~ risk</span></span>
<span id="cb3-29"><a></a>        zeros1 <span class="op">=</span> pt.set_subtensor(zeros[<span class="dv">1</span>, <span class="dv">0</span>], coefs[<span class="dv">0</span>])</span>
<span id="cb3-30"><a></a>        <span class="co">## achieve ~ risk + adjust</span></span>
<span id="cb3-31"><a></a>        zeros2 <span class="op">=</span> pt.set_subtensor(zeros1[<span class="dv">1</span>, <span class="dv">2</span>], coefs[<span class="dv">1</span>])</span>
<span id="cb3-32"><a></a>        coefs_ <span class="op">=</span> pt.set_subtensor(zeros2[<span class="dv">0</span>, <span class="dv">2</span>], coefs[<span class="dv">2</span>])</span>
<span id="cb3-33"><a></a>        </span>
<span id="cb3-34"><a></a>        structural_relations <span class="op">=</span> pm.Deterministic(<span class="st">'endogenous_structural_paths'</span>, </span>
<span id="cb3-35"><a></a>        pm.math.dot(ksi, coefs_))</span>
<span id="cb3-36"><a></a></span>
<span id="cb3-37"><a></a>        <span class="co"># Construct Pseudo Observation matrix based on Factor Loadings</span></span>
<span id="cb3-38"><a></a>        m1 <span class="op">=</span> ksi[obs_idx, <span class="dv">0</span>] <span class="op">*</span> lambdas_1[<span class="dv">0</span>] <span class="op">+</span>  structural_relations[obs_idx, <span class="dv">0</span>] <span class="co">#adjust</span></span>
<span id="cb3-39"><a></a>        m2 <span class="op">=</span> ksi[obs_idx, <span class="dv">0</span>] <span class="op">*</span> lambdas_1[<span class="dv">1</span>] <span class="op">+</span>  structural_relations[obs_idx, <span class="dv">0</span>] <span class="co">#adjust</span></span>
<span id="cb3-40"><a></a>        m3 <span class="op">=</span> ksi[obs_idx, <span class="dv">0</span>] <span class="op">*</span> lambdas_1[<span class="dv">2</span>] <span class="op">+</span>  structural_relations[obs_idx, <span class="dv">0</span>] <span class="co">#adjust</span></span>
<span id="cb3-41"><a></a>        m4 <span class="op">=</span> ksi[obs_idx, <span class="dv">1</span>] <span class="op">*</span> lambdas_2[<span class="dv">0</span>] <span class="op">+</span>  structural_relations[obs_idx, <span class="dv">1</span>]  <span class="co">#risk</span></span>
<span id="cb3-42"><a></a>        m5 <span class="op">=</span> ksi[obs_idx, <span class="dv">1</span>] <span class="op">*</span> lambdas_2[<span class="dv">1</span>] <span class="op">+</span>  structural_relations[obs_idx, <span class="dv">1</span>]  <span class="co">#risk</span></span>
<span id="cb3-43"><a></a>        m6 <span class="op">=</span> ksi[obs_idx, <span class="dv">1</span>] <span class="op">*</span> lambdas_2[<span class="dv">2</span>] <span class="op">+</span>  structural_relations[obs_idx, <span class="dv">1</span>]  <span class="co">#risk</span></span>
<span id="cb3-44"><a></a>        m7 <span class="op">=</span> ksi[obs_idx, <span class="dv">2</span>] <span class="op">*</span> lambdas_3[<span class="dv">0</span>] <span class="op">+</span>  structural_relations[obs_idx, <span class="dv">2</span>]  <span class="co">#achieve</span></span>
<span id="cb3-45"><a></a>        m8 <span class="op">=</span> ksi[obs_idx, <span class="dv">2</span>] <span class="op">*</span> lambdas_3[<span class="dv">1</span>] <span class="op">+</span>  structural_relations[obs_idx, <span class="dv">2</span>]  <span class="co">#achieve</span></span>
<span id="cb3-46"><a></a>        m9 <span class="op">=</span> ksi[obs_idx, <span class="dv">2</span>] <span class="op">*</span> lambdas_3[<span class="dv">2</span>] <span class="op">+</span>  structural_relations[obs_idx, <span class="dv">2</span>]  <span class="co">#achieve</span></span>
<span id="cb3-47"><a></a></span>
<span id="cb3-48"><a></a>        mu <span class="op">=</span> pm.Deterministic(<span class="st">"mu"</span>, pm.math.stack([m1, m2, m3, m4, m5, m6, m7, m8, m9]).T)</span>
<span id="cb3-49"><a></a></span>
<span id="cb3-50"><a></a></span>
<span id="cb3-51"><a></a>        <span class="co">## Error Terms</span></span>
<span id="cb3-52"><a></a>        Psi <span class="op">=</span> pm.InverseGamma(<span class="st">"Psi"</span>, <span class="dv">2</span>, <span class="dv">13</span>, dims<span class="op">=</span><span class="st">"indicators"</span>)</span>
<span id="cb3-53"><a></a></span>
<span id="cb3-54"><a></a>        <span class="co"># Likelihood</span></span>
<span id="cb3-55"><a></a>        _ <span class="op">=</span> pm.Normal(</span>
<span id="cb3-56"><a></a>            <span class="st">"likelihood"</span>,</span>
<span id="cb3-57"><a></a>            mu,</span>
<span id="cb3-58"><a></a>            Psi,</span>
<span id="cb3-59"><a></a>            observed<span class="op">=</span>df[coords[<span class="st">'indicators'</span>]].values,</span>
<span id="cb3-60"><a></a>        )</span>
<span id="cb3-61"><a></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="model-comparison" class="slide level2">
<h2>Model Comparison</h2>
<h3 id="local-and-global-fit">Local and Global Fit</h3>
<div class="columns">
<div class="column">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/resids_sem.png"></p>
<figcaption>Local Model checks</figcaption>
</figure>
</div>
</div><div class="column">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/model_compare.png"></p>
<figcaption>Model ranked on Leave one out cross validation</figcaption>
</figure>
</div>
</div><p>SEM model achieves better performance on the local and global model checks than the CFA model</p>
</div>
</section>
<section id="causal-estimands-and-the-do-operator" class="slide level2 smaller">
<h2>Causal Estimands and the Do-Operator</h2>
<div class="columns">
<div class="column">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/three_levels.jpg"></p>
<figcaption>Causal Hierarchy</figcaption>
</figure>
</div>
</div><div class="column">
<p>The graph algebra of the <strong><span class="blue">do-calculus</span></strong> sets rules on admissable structures required to warrant valid causal claims when accounting for different species of confounding.</p>
<p>They complement the development and analysis of SEM models, providing minimalist <strong><span class="blue">admissablility conditions for a causal interpretation</span></strong> of these structural relations.</p>
<p>The substantive justification of the causal claims implicit in a SEM model need to be made more explicitly by the researcher with reference to evaluation of model fit to data by comparing to competing models.</p>
</div></div>
</section>
<section id="what-if-structures-and-the-do-operator" class="slide level2 smaller">
<h2>What-if Structures and the Do-Operator</h2>
<div class="columns">
<div class="column">
<blockquote>
<p>“[T]ypically the causal assumptions are less established, though they should be defensible and consistent with the current state of knowledge. <strong><span class="blue">The analysis is done under the speculation of “what if these causal assumptions were true.”</span></strong> These latter analyses are useful because there are often ways of testing the model, or parts of it. These tests can be helpful in rejecting one or more of the causal assumptions, thereby revealing flaws in specification. Of course, passing these tests does not prove the validity of the causal assumptions, but it lends credibility to them.”</p>
</blockquote>
<ul>
<li>Bollen and Pearl in <em>Eight myths about causality and structural equation models</em></li>
</ul>
</div><div class="column">
<div class="fragment fade-in">
<p><img data-src="images/intervention_dist.png"></p>
<p>The Do-Operator uses graph mutilation techniques to interrogate the impact of different data generating conditions including the analysis of causal claims.</p>
</div>
</div></div>
</section>
<section id="graph-mutilation-in-pymc" class="slide level2">
<h2>Graph Mutilation in PyMC</h2>
<div class="columns">
<div class="column">
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a></a><span class="co">## Model Estimated on Data</span></span>
<span id="cb4-2"><a></a>idata_sem, model_sem <span class="op">=</span> make_sem()</span>
<span id="cb4-3"><a></a>pm.model_to_graphviz(model_sem)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img data-src="images/sem_model_graph.png"></p>
</div><div class="column">
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a></a><span class="co">## The Do-Operator in Action</span></span>
<span id="cb5-2"><a></a>model_beta0 <span class="op">=</span> do(model_sem, </span>
<span id="cb5-3"><a></a>{<span class="st">"betas"</span>: [<span class="dv">0</span>, <span class="dv">0</span> , <span class="dv">0</span>]}, </span>
<span id="cb5-4"><a></a>prune_vars<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-5"><a></a>pm.model_to_graphviz(model_beta0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img data-src="images/mutilated_sem_graph.png"></p>
</div></div>
</section>
<section id="causal-estimands-under-intervention" class="slide level2">
<h2>Causal Estimands under Intervention</h2>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a></a>model_beta0 <span class="op">=</span> do(model_sem, {<span class="st">"betas"</span>: [<span class="dv">0</span>, <span class="dv">0</span> , <span class="dv">0</span>]}, prune_vars<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-2"><a></a>model_beta1 <span class="op">=</span> do(model_sem, {<span class="st">"betas"</span>: [<span class="fl">.6</span>, <span class="fl">.3</span>, <span class="fl">.7</span>]}, prune_vars<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-3"><a></a></span>
<span id="cb6-4"><a></a><span class="co"># Sample new data assuming path parameters 0: P(Y | c, do(beta=0))</span></span>
<span id="cb6-5"><a></a>idata_z0 <span class="op">=</span> pm.sample_posterior_predictive(</span>
<span id="cb6-6"><a></a>    idata_sem,</span>
<span id="cb6-7"><a></a>    model<span class="op">=</span>model_beta0,</span>
<span id="cb6-8"><a></a>    predictions<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb6-9"><a></a>    var_names<span class="op">=</span>[<span class="st">"likelihood"</span>, <span class="st">"betas"</span>,],</span>
<span id="cb6-10"><a></a>)</span>
<span id="cb6-11"><a></a><span class="co"># Sample new data assuming substantive specification: P(Y | c, do(z=[.6, .3, .7]))</span></span>
<span id="cb6-12"><a></a>idata_z1 <span class="op">=</span> pm.sample_posterior_predictive(</span>
<span id="cb6-13"><a></a>    idata_sem,</span>
<span id="cb6-14"><a></a>    model<span class="op">=</span>model_beta1,</span>
<span id="cb6-15"><a></a>    predictions<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb6-16"><a></a>    var_names<span class="op">=</span>[<span class="st">"likelihood"</span>, <span class="st">"betas"</span>],</span>
<span id="cb6-17"><a></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="causal-estimands-under-intervention-1" class="slide level2">
<h2>Causal Estimands under Intervention</h2>
<p><span class="math display">\[ E\Big[(Y| do(\beta=0)) - (Y | do(\beta \neq 0) \Big] \]</span> <img data-src="images/causal_estimands.png"></p>
</section>
<section id="model-fit-sensitivity-under-intervention" class="slide level2">
<h2>Model Fit: Sensitivity under Intervention</h2>
<div class="columns">
<div class="column">
<p><img data-src="images/counterfactual_residuals.png"></p>
</div><div class="column">
<p><img data-src="images/0d_residuals.png"></p>
</div><p>The plots are scaled identically here between -1 and 1. Highlighting significantly worse model fit under implausibly zero’d out beta coefficients.</p>
</div>
</section>
<section id="conclusion" class="slide level2 smaller">
<h2>Conclusion</h2>
<h3 class="smaller" id="credibility-versus-certification">Credibility versus Certification</h3>
<div class="columns">
<div class="column r-fit-text">
<blockquote>
<p>“SEM is an inference engine that takes in two inputs, qualitative causal assumptions and empirical data, and derives two logical consequences of these inputs: quantitative causal conclusions and statistical measures of fit for the testable implications of the assumptions. Failure to fit the data casts doubt on the strong causal assumptions of zero coefficients or zero covariances and guides the researcher to diagnose, or repair the structural misspecifications. <strong><span class="blue">Fitting the data does not “prove” the causal assumptions, but it makes them tentatively more plausible.</span></strong>”</p>
</blockquote>
<ul>
<li>Bollen and Pearl in <em>Eight myths about causality and structural equation models</em></li>
</ul>
</div><div class="column">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/starON.jpg"></p>
<figcaption>An Inference Engine adding ***’s to our conclusion</figcaption>
</figure>
</div>
</div></div>


</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="images/pymc_logo.png" class="slide-logo"></p>
<div class="footer footer-default">
<p>SCMS in PyMC</p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>